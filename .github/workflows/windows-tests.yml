name: Windows-specific tests
on:
  workflow_dispatch:
  push:
    branches:
      - main
      - eculver/ci-nightly-windows-tests # This is a temporary hack to get the workflow to run on my PR branch
jobs:
  python-tests:
    name: Python tests (Windows)
    uses: ./.github/workflows/_python-tests.yml
    with:
      property_testing_preset: 'normal'
      platform: '16core-64gb-windows-latest'
      env-file: 'compose-env.windows'

  notify-on-failure:
    name: Notify on failure
    needs: python-tests
    if: failure()
    runs-on: blacksmith-4vcpu-ubuntu-2204
    steps:
      - name: Send PagerDuty alert on failure
        if: ${{ failure() }}
        uses: Entle/action-pagerduty-alert@0.2.0
        with:
          pagerduty-integration-key: '${{ secrets.PAGERDUTY_INTEGRATION_KEY }}'
          pagerduty-dedup-key: nightly-windows-tests-failed